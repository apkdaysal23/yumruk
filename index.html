<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ü•ä Punch Toy Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a1a;
            --accent-primary: #ff3366;
            --accent-glow: #00d4ff;
            --text-primary: #ffffff;
            --text-secondary: #a0a0c0;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(255, 51, 102, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(108, 92, 231, 0.1) 0%, transparent 60%);
            z-index: -2;
            animation: bgPulse 6s ease-in-out infinite alternate;
        }

        @keyframes bgPulse {
            0% {
                opacity: 0.8;
            }

            100% {
                opacity: 1;
            }
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.03)"/></svg>');
            background-size: 30px 30px;
            z-index: -1;
        }

        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100vh;
            padding: 15px;
        }

        .screen.active {
            display: flex;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* MAIN MENU */
        .game-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-logo .icon {
            font-size: 4rem;
            display: block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .game-logo h1 {
            font-size: 2.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ff3366, #00d4ff, #6c5ce7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 200%;
            animation: gradient 3s ease infinite;
        }

        @keyframes gradient {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .game-logo p {
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 280px;
        }

        .menu-btn {
            padding: 16px 40px;
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .menu-btn.primary {
            background: linear-gradient(135deg, #ff3366, #ff6b8a);
            color: white;
            box-shadow: 0 8px 30px rgba(255, 51, 102, 0.4);
        }

        .menu-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(255, 51, 102, 0.5);
        }

        .menu-btn.secondary {
            background: var(--glass-bg);
            color: var(--text-primary);
            border: 2px solid var(--glass-border);
        }

        .menu-btn.secondary:hover {
            border-color: var(--accent-glow);
        }

        .menu-btn:active {
            transform: scale(0.97);
        }

        /* SETTINGS */
        .settings-panel {
            max-width: 380px;
            width: 100%;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .settings-header h2 {
            color: var(--text-primary);
            font-size: 1.6rem;
        }

        .back-btn {
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            color: var(--text-primary);
            width: 45px;
            height: 45px;
            border-radius: 12px;
            font-size: 1.3rem;
            cursor: pointer;
        }

        .settings-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-primary);
        }

        .setting-label .icon {
            font-size: 1.5rem;
        }

        .volume-slider {
            width: 100px;
            height: 6px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #ff3366, #00d4ff);
            border-radius: 50%;
            cursor: pointer;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 26px;
            transition: 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle-switch input:checked+.toggle-slider {
            background: linear-gradient(135deg, #ff3366, #00d4ff);
        }

        .toggle-switch input:checked+.toggle-slider::before {
            transform: translateX(24px);
        }

        /* Body Type Selector */
        .body-type-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .body-type-btn {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            border: 2px solid var(--glass-border);
            background: var(--glass-bg);
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s;
        }

        .body-type-btn.active {
            border-color: var(--accent-glow);
            background: rgba(0, 212, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        /* GAME SCREEN */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 360px;
            margin-bottom: 10px;
            gap: 10px;
        }

        .health-bar-container {
            flex: 1;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            border: 2px solid var(--glass-border);
            position: relative;
        }

        .health-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff3366, #ff6b8a);
            transition: width 0.3s ease;
            border-radius: 8px;
        }

        .health-bar.low {
            background: linear-gradient(90deg, #ff0000, #ff4444);
        }

        .health-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 0.85rem;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        .game-menu-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* Joker Buttons */
        .joker-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .joker-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 10px 15px;
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 70px;
        }

        .joker-btn:hover:not(.disabled) {
            border-color: var(--accent-glow);
            transform: translateY(-2px);
        }

        .joker-btn.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .joker-btn.active {
            border-color: #ff3366;
            box-shadow: 0 0 20px rgba(255, 51, 102, 0.5);
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .joker-btn .icon {
            font-size: 1.8rem;
        }

        .joker-btn .uses {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Character */
        .character-container {
            position: relative;
            width: 300px;
            height: 480px;
        }

        #bodyCanvas {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
        }

        .head-container {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 140px;
            cursor: pointer;
            z-index: 10;
        }

        .head {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            transition: filter 0.3s;
        }

        .head img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }

        .head.stage-1 {
            filter: brightness(0.95);
        }

        .head.stage-2 {
            filter: brightness(0.9) saturate(0.9);
        }

        .head.stage-3 {
            filter: brightness(0.85) saturate(0.8);
        }

        .head.stage-4 {
            filter: brightness(0.75) saturate(0.7) contrast(1.1);
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(-50%);
            }

            25% {
                transform: translateX(calc(-50% + 8px)) rotate(2deg);
            }

            75% {
                transform: translateX(calc(-50% - 8px)) rotate(-2deg);
            }
        }

        .head-container.shake {
            animation: shake 0.3s ease-in-out;
        }

        .effects-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            border-radius: 50%;
            overflow: hidden;
        }

        .bruise {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(ellipse, rgba(139, 69, 139, 0.7) 0%, rgba(75, 0, 130, 0.4) 40%, transparent 70%);
            transform: translate(-50%, -50%);
            animation: bruiseAppear 1.5s ease-out forwards;
            filter: blur(3px);
        }

        @keyframes bruiseAppear {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.3);
            }

            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .star-effect {
            position: absolute;
            font-size: 26px;
            transform: translate(-50%, -50%);
            animation: starPop 0.5s ease-out forwards;
            z-index: 100;
        }

        @keyframes starPop {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0) rotate(0);
            }

            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.5) rotate(180deg);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5) rotate(360deg);
            }
        }

        .speech-bubble {
            position: absolute;
            top: -55px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 0.9rem;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: bubblePop 2s ease-out forwards;
            z-index: 200;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: white;
            border-bottom: none;
        }

        @keyframes bubblePop {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(15px) scale(0.5);
            }

            15% {
                opacity: 1;
                transform: translateX(-50%) translateY(0) scale(1);
            }

            85% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
        }

        .tears-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .tears-container.visible {
            opacity: 1;
        }

        .tear {
            position: absolute;
            font-size: 20px;
            animation: tearDrop 1s ease-in infinite;
        }

        .tear.left {
            left: 20%;
            top: 55%;
        }

        .tear.right {
            right: 20%;
            top: 55%;
            animation-delay: 0.5s;
        }

        @keyframes tearDrop {
            0% {
                opacity: 0;
                transform: translateY(-8px) scale(0.5);
            }

            30% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(25px) scale(0.7);
            }
        }

        /* Lightning Effect */
        .lightning-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            animation: lightningFlash 0.6s ease-out forwards;
            z-index: 300;
        }

        @keyframes lightningFlash {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }

            30% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.5);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(2);
            }
        }

        /* Big Punch Effect */
        .bigpunch-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            animation: bigPunchHit 0.8s ease-out forwards;
            z-index: 300;
        }

        @keyframes bigPunchHit {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0) rotate(-30deg);
            }

            30% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.3) rotate(15deg);
            }

            60% {
                transform: translate(-50%, -50%) scale(1) rotate(0);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        /* End Message */
        .end-message {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .end-message.visible {
            display: flex;
            animation: fadeIn 0.5s;
        }

        .end-message-content {
            background: linear-gradient(145deg, #12122a, #1a1a35);
            border: 1px solid var(--glass-border);
            padding: 40px 35px;
            border-radius: 25px;
            text-align: center;
            animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes bounceIn {
            from {
                transform: scale(0.3);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .end-message-content .emoji {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .end-message-content h2 {
            color: var(--text-primary);
            font-size: 1.6rem;
            margin-bottom: 8px;
        }

        .end-message-content p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .end-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .heart-particle {
            position: fixed;
            font-size: 24px;
            pointer-events: none;
            animation: heartFloat 2s ease-out forwards;
            z-index: 1001;
        }

        @keyframes heartFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(0);
            }

            20% {
                opacity: 1;
                transform: translateY(-15px) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-120px) scale(0.5) rotate(15deg);
            }
        }

        html,
        body {
            overscroll-behavior: none;
            touch-action: manipulation;
        }

        @media (max-width: 380px) {
            .character-container {
                width: 260px;
                height: 420px;
            }

            .head-container {
                width: 120px;
                height: 120px;
            }
        }
    </style>
</head>

<body>
    <!-- MAIN MENU -->
    <div class="screen active" id="mainMenuScreen">
        <div class="game-logo">
            <span class="icon">ü•ä</span>
            <h1>Punch Toy</h1>
            <p>Eƒülenceli Y√ºz Oyunu</p>
        </div>
        <div class="menu-buttons">
            <button class="menu-btn primary" id="startGameBtn">üéÆ Oyuna Ba≈üla</button>
            <button class="menu-btn secondary" id="settingsBtn">‚öôÔ∏è Ayarlar</button>
        </div>
    </div>

    <!-- SETTINGS -->
    <div class="screen" id="settingsScreen">
        <div class="settings-panel">
            <div class="settings-header">
                <h2>‚öôÔ∏è Ayarlar</h2>
                <button class="back-btn" id="settingsBackBtn">‚Üê</button>
            </div>
            <div class="settings-card">
                <div class="setting-item">
                    <div class="setting-label"><span class="icon">üîä</span><span>Ses</span></div>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
                </div>
                <div class="setting-item">
                    <div class="setting-label"><span class="icon">üì≥</span><span>Titre≈üim</span></div>
                    <label class="toggle-switch"><input type="checkbox" id="vibrationToggle" checked><span
                            class="toggle-slider"></span></label>
                </div>
                <div class="setting-item">
                    <div class="setting-label"><span class="icon">üëî</span><span>V√ºcut Tipi</span></div>
                    <div class="body-type-selector" id="bodyTypeSelector">
                        <button class="body-type-btn active" data-type="business">üëî</button>
                        <button class="body-type-btn" data-type="casual">üëï</button>
                        <button class="body-type-btn" data-type="sports">üéΩ</button>
                        <button class="body-type-btn" data-type="doctor">ü•º</button>
                        <button class="body-type-btn" data-type="chef">üë®‚Äçüç≥</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- GAME -->
    <div class="screen" id="gameScreen">
        <div class="game-header">
            <div class="health-bar-container">
                <div class="health-bar" id="healthBar"></div>
                <span class="health-text" id="healthText">100%</span>
            </div>
            <button class="game-menu-btn" id="gameMenuBtn">‚ò∞</button>
        </div>
        <div class="joker-bar">
            <button class="joker-btn" id="lightningJoker"><span class="icon">‚ö°</span><span
                    class="name">≈ûim≈üek</span><span class="uses" id="lightningUses">1</span></button>
            <button class="joker-btn" id="bigPunchJoker"><span class="icon">üëä</span><span class="name">Dev
                    Yumruk</span><span class="uses" id="bigPunchUses">1</span></button>
        </div>
        <div class="character-container" id="characterContainer">
            <canvas id="bodyCanvas" width="260" height="350"></canvas>
            <div class="head-container" id="headContainer">
                <div class="head" id="head"><img id="headImage" src="ornek1.jpg" alt=""></div>
                <div class="effects-layer" id="effectsLayer"></div>
                <div class="tears-container" id="tearsContainer"><span class="tear left">üíß</span><span
                        class="tear right">üíß</span></div>
            </div>
        </div>
    </div>

    <!-- END MESSAGE -->
    <div class="end-message" id="endMessage">
        <div class="end-message-content">
            <div class="emoji">üò≠üíï</div>
            <h2>Tamam durr!</h2>
            <p>Artƒ±k yapma! üôè</p>
            <div class="end-buttons">
                <button class="menu-btn primary" id="restartBtn">üîÑ Tekrar</button>
                <button class="menu-btn secondary" id="menuBtn">üè† Men√º</button>
            </div>
        </div>
    </div>

    <script>
        // STATE
        const state = {
            health: 100,
            maxHealth: 100,
            lightningUses: 1,
            bigPunchUses: 1,
            isGameOver: false,
            bodyType: 'business'
        };

        const settings = { volume: 0.7, vibration: true };

        // Damage values
        const DAMAGE = { normal: 5, lightning: 25, bigPunch: 35 };

        // Apology texts - expanded
        const apologyTexts = [
            "Ayy! üò£", "Neden?! üò¢", "Acƒ±yor! üíî", "Dur artƒ±k! üò≠", "Off! üòµ",
            "Yapmaaa! ü•∫", "Canƒ±m yandƒ±! üòø", "Ahh! üò´", "L√ºtfen dur! üôè",
            "√ñz√ºr dilerim! üò¢", "Ne yaptƒ±m ki? ü•∫", "Aƒülƒ±yorum! üò≠",
            "Acƒ±! Acƒ±! üí•", "Tamam anladƒ±m! üò£", "Barƒ±≈üalƒ±m! üíï",
            "Yeter be! üò§", "Aman! üò±", "Auu! ü§ï", "Merhamet! üôà",
            "Kalbim kƒ±rƒ±ldƒ±! üíî", "√áok acƒ±! üòñ", "Affet beni! ü•π",
            "Dur l√ºtfen! üò∞", "Nolur yapma! üò•", "Sen kazandƒ±n! üè≥Ô∏è",
            "Hayƒ±r! üò©", "Bƒ±rak beni! üò≠", "Zalim! üòø", "Pes ediyorum! üôå"
        ];

        // DOM
        const el = {
            mainMenu: document.getElementById('mainMenuScreen'),
            settings: document.getElementById('settingsScreen'),
            game: document.getElementById('gameScreen'),
            startBtn: document.getElementById('startGameBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsBack: document.getElementById('settingsBackBtn'),
            gameMenuBtn: document.getElementById('gameMenuBtn'),
            volumeSlider: document.getElementById('volumeSlider'),
            vibrationToggle: document.getElementById('vibrationToggle'),
            bodyTypeSelector: document.getElementById('bodyTypeSelector'),
            headContainer: document.getElementById('headContainer'),
            head: document.getElementById('head'),
            effectsLayer: document.getElementById('effectsLayer'),
            tearsContainer: document.getElementById('tearsContainer'),
            healthBar: document.getElementById('healthBar'),
            healthText: document.getElementById('healthText'),
            lightningJoker: document.getElementById('lightningJoker'),
            bigPunchJoker: document.getElementById('bigPunchJoker'),
            lightningUses: document.getElementById('lightningUses'),
            bigPunchUses: document.getElementById('bigPunchUses'),
            endMessage: document.getElementById('endMessage'),
            restartBtn: document.getElementById('restartBtn'),
            menuBtn: document.getElementById('menuBtn'),
            canvas: document.getElementById('bodyCanvas')
        };

        const ctx = el.canvas.getContext('2d');

        // BODY DRAWING
        function drawBody() {
            const w = el.canvas.width, h = el.canvas.height;
            ctx.clearRect(0, 0, w, h);

            const cx = w / 2;

            // Neck
            ctx.fillStyle = '#e8c4b8';
            ctx.beginPath();
            ctx.moveTo(cx - 20, 0);
            ctx.lineTo(cx + 20, 0);
            ctx.lineTo(cx + 25, 45);
            ctx.lineTo(cx - 25, 45);
            ctx.closePath();
            ctx.fill();

            const bodyColors = {
                business: { main: '#2c3e50', accent: '#34495e', shirt: '#ecf0f1', tie: '#e74c3c' },
                casual: { main: '#3498db', accent: '#2980b9', shirt: '#ffffff', tie: null },
                sports: { main: '#e74c3c', accent: '#c0392b', shirt: '#ffffff', tie: null },
                doctor: { main: '#ecf0f1', accent: '#bdc3c7', shirt: '#3498db', tie: null },
                chef: { main: '#ecf0f1', accent: '#bdc3c7', shirt: '#2c3e50', tie: null }
            };

            const colors = bodyColors[state.bodyType];

            // Torso
            ctx.fillStyle = colors.main;
            ctx.beginPath();
            ctx.moveTo(cx - 70, 45);
            ctx.quadraticCurveTo(cx - 90, 50, cx - 95, 75);
            ctx.lineTo(cx - 85, 240);
            ctx.quadraticCurveTo(cx - 80, 260, cx - 50, 265);
            ctx.lineTo(cx + 50, 265);
            ctx.quadraticCurveTo(cx + 80, 260, cx + 85, 240);
            ctx.lineTo(cx + 95, 75);
            ctx.quadraticCurveTo(cx + 90, 50, cx + 70, 45);
            ctx.closePath();
            ctx.fill();

            // Collar/Shirt
            ctx.fillStyle = colors.shirt;
            ctx.beginPath();
            ctx.moveTo(cx - 12, 45);
            ctx.lineTo(cx + 12, 45);
            ctx.lineTo(cx + 10, 265);
            ctx.lineTo(cx - 10, 265);
            ctx.closePath();
            ctx.fill();

            // Tie (only for business)
            if (colors.tie) {
                ctx.fillStyle = colors.tie;
                ctx.beginPath();
                ctx.moveTo(cx - 8, 50);
                ctx.lineTo(cx + 8, 50);
                ctx.lineTo(cx + 10, 180);
                ctx.lineTo(cx, 200);
                ctx.lineTo(cx - 10, 180);
                ctx.closePath();
                ctx.fill();
            }

            // Arms
            ctx.fillStyle = colors.main;
            [-1, 1].forEach(side => {
                ctx.beginPath();
                ctx.moveTo(cx + side * 85, 70);
                ctx.quadraticCurveTo(cx + side * 110, 90, cx + side * 105, 180);
                ctx.lineTo(cx + side * 100, 260);
                ctx.lineTo(cx + side * 70, 265);
                ctx.lineTo(cx + side * 65, 180);
                ctx.quadraticCurveTo(cx + side * 70, 90, cx + side * 85, 70);
                ctx.closePath();
                ctx.fill();
            });

            // Hands
            ctx.fillStyle = '#e8c4b8';
            ctx.beginPath(); ctx.ellipse(cx - 85, 275, 15, 18, 0, 0, Math.PI * 2); ctx.fill();
            ctx.beginPath(); ctx.ellipse(cx + 85, 275, 15, 18, 0, 0, Math.PI * 2); ctx.fill();

            // Pants
            ctx.fillStyle = colors.accent;
            ctx.fillRect(cx - 50, 260, 40, h - 260);
            ctx.fillRect(cx + 10, 260, 40, h - 260);

            // Belt
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(cx - 50, 255, 100, 12);
            ctx.fillStyle = '#f1c40f';
            ctx.fillRect(cx - 6, 257, 12, 8);
        }

        drawBody();

        // AUDIO
        let audioCtx = null;
        function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }

        function playSound(type) {
            if (!audioCtx || settings.volume === 0) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'hit') {
                osc.frequency.setValueAtTime(300, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(80, audioCtx.currentTime + 0.15);
                osc.type = 'square';
            } else if (type === 'lightning') {
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                osc.type = 'sawtooth';
            } else if (type === 'bigpunch') {
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(30, audioCtx.currentTime + 0.4);
                osc.type = 'square';
            }

            gain.gain.setValueAtTime(0.3 * settings.volume, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        }

        function vibrate(ms = 50) { if (settings.vibration && navigator.vibrate) navigator.vibrate(ms); }

        // SCREEN NAV
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // GAME LOGIC
        function updateHealthBar() {
            const pct = Math.max(0, state.health);
            el.healthBar.style.width = pct + '%';
            el.healthText.textContent = Math.round(pct) + '%';
            el.healthBar.classList.toggle('low', pct < 50);

            // Permanent tears below 50%
            if (pct < 50) el.tearsContainer.classList.add('visible');

            // Update head stage
            el.head.classList.remove('stage-1', 'stage-2', 'stage-3', 'stage-4');
            if (pct < 75) el.head.classList.add('stage-1');
            if (pct < 50) el.head.classList.add('stage-2');
            if (pct < 30) el.head.classList.add('stage-3');
            if (pct < 15) el.head.classList.add('stage-4');
        }

        function updateJokerUI() {
            el.lightningUses.textContent = state.lightningUses;
            el.bigPunchUses.textContent = state.bigPunchUses;
            el.lightningJoker.classList.toggle('disabled', state.lightningUses <= 0);
            el.bigPunchJoker.classList.toggle('disabled', state.bigPunchUses <= 0);
        }

        function createEffect(x, y, type) {
            if (type === 'bruise') {
                const div = document.createElement('div');
                div.className = 'bruise';
                div.style.cssText = `left:${x}%;top:${y}%;width:${40 + Math.random() * 20}px;height:${40 + Math.random() * 20}px`;
                el.effectsLayer.appendChild(div);
                setTimeout(() => div.remove(), 1500);
            } else if (type === 'star') {
                const span = document.createElement('span');
                span.className = 'star-effect';
                span.textContent = ['‚≠ê', 'üí•', '‚ú®', 'üí´', '‚ö°'][Math.floor(Math.random() * 5)];
                span.style.cssText = `left:${x}%;top:${y}%`;
                el.effectsLayer.appendChild(span);
                setTimeout(() => span.remove(), 500);
            } else if (type === 'lightning') {
                const span = document.createElement('span');
                span.className = 'lightning-effect';
                span.textContent = '‚ö°';
                el.effectsLayer.appendChild(span);
                setTimeout(() => span.remove(), 600);
            } else if (type === 'bigpunch') {
                const span = document.createElement('span');
                span.className = 'bigpunch-effect';
                span.textContent = 'üëä';
                el.effectsLayer.appendChild(span);
                setTimeout(() => span.remove(), 800);
            }
        }

        function showBubble() {
            const old = el.headContainer.querySelector('.speech-bubble');
            if (old) old.remove();
            const div = document.createElement('div');
            div.className = 'speech-bubble';
            div.textContent = apologyTexts[Math.floor(Math.random() * apologyTexts.length)];
            el.headContainer.appendChild(div);
            setTimeout(() => div.remove(), 2000);
        }

        function shake() {
            el.headContainer.classList.add('shake');
            setTimeout(() => el.headContainer.classList.remove('shake'), 300);
        }

        function dealDamage(amount) {
            state.health -= amount;
            updateHealthBar();
            if (state.health <= 0) endGame();
        }

        function handleHit(e) {
            if (state.isGameOver) return;
            e.preventDefault();

            const rect = el.headContainer.getBoundingClientRect();
            const touch = e.touches ? e.touches[0] : e;
            const x = ((touch.clientX - rect.left) / rect.width) * 100;
            const y = ((touch.clientY - rect.top) / rect.height) * 100;

            createEffect(x, y, 'bruise');
            createEffect(x, y, 'star');
            showBubble();
            shake();
            playSound('hit');
            vibrate();
            dealDamage(DAMAGE.normal);
        }

        function useLightning() {
            if (state.lightningUses <= 0 || state.isGameOver) return;
            state.lightningUses--;
            updateJokerUI();

            el.lightningJoker.classList.add('active');
            setTimeout(() => el.lightningJoker.classList.remove('active'), 500);

            createEffect(50, 50, 'lightning');
            showBubble();
            shake();
            playSound('lightning');
            vibrate([50, 30, 50]);
            dealDamage(DAMAGE.lightning);
        }

        function useBigPunch() {
            if (state.bigPunchUses <= 0 || state.isGameOver) return;
            state.bigPunchUses--;
            updateJokerUI();

            el.bigPunchJoker.classList.add('active');
            setTimeout(() => el.bigPunchJoker.classList.remove('active'), 500);

            createEffect(50, 50, 'bigpunch');
            showBubble();
            shake();
            playSound('bigpunch');
            vibrate([100, 50, 100]);
            dealDamage(DAMAGE.bigPunch);
        }

        function endGame() {
            state.isGameOver = true;
            setTimeout(() => {
                el.endMessage.classList.add('visible');
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('span');
                        heart.className = 'heart-particle';
                        heart.textContent = ['‚ù§Ô∏è', 'üíï', 'üíñ'][Math.floor(Math.random() * 3)];
                        heart.style.cssText = `left:${20 + Math.random() * 60}%;top:${40 + Math.random() * 30}%`;
                        document.body.appendChild(heart);
                        setTimeout(() => heart.remove(), 2000);
                    }, i * 100);
                }
            }, 400);
        }

        function resetGame() {
            state.health = state.maxHealth;
            state.lightningUses = 1;
            state.bigPunchUses = 1;
            state.isGameOver = false;

            el.endMessage.classList.remove('visible');
            el.head.classList.remove('stage-1', 'stage-2', 'stage-3', 'stage-4');
            el.tearsContainer.classList.remove('visible');
            el.effectsLayer.innerHTML = '';
            const bubble = el.headContainer.querySelector('.speech-bubble');
            if (bubble) bubble.remove();

            updateHealthBar();
            updateJokerUI();
        }

        // EVENT LISTENERS
        el.startBtn.addEventListener('click', () => { initAudio(); resetGame(); showScreen('gameScreen'); });
        el.settingsBtn.addEventListener('click', () => showScreen('settingsScreen'));
        el.settingsBack.addEventListener('click', () => showScreen('mainMenuScreen'));
        el.gameMenuBtn.addEventListener('click', () => { resetGame(); showScreen('mainMenuScreen'); });

        el.volumeSlider.addEventListener('input', e => settings.volume = e.target.value / 100);
        el.vibrationToggle.addEventListener('change', e => settings.vibration = e.target.checked);

        el.bodyTypeSelector.addEventListener('click', e => {
            const btn = e.target.closest('.body-type-btn');
            if (!btn) return;
            el.bodyTypeSelector.querySelectorAll('.body-type-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            state.bodyType = btn.dataset.type;
            drawBody();
        });

        el.headContainer.addEventListener('click', handleHit);
        el.headContainer.addEventListener('touchstart', handleHit, { passive: false });

        el.lightningJoker.addEventListener('click', useLightning);
        el.bigPunchJoker.addEventListener('click', useBigPunch);

        el.restartBtn.addEventListener('click', resetGame);
        el.menuBtn.addEventListener('click', () => { resetGame(); showScreen('mainMenuScreen'); });

        el.headContainer.addEventListener('contextmenu', e => e.preventDefault());
        document.body.addEventListener('touchmove', e => { if (el.game.classList.contains('active')) e.preventDefault(); }, { passive: false });

        // Init
        updateHealthBar();
        updateJokerUI();
    </script>
</body>

</html>